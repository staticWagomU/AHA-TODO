---
import { getTodos, writeTodos, type Todo } from "../../todoFileOperations";

let todos: Todo[] = [];
const { id } = Astro.params;
try {
  todos = getTodos();

  const requestMethod = Astro.request.method;
  if (requestMethod === "PUT") {
    // idが一致するtodoのcompleteを反転させる
    todos = todos.map((todo: Todo) => {
      if (todo.id === Number(id)) {
        return { ...todo, complete: !todo.complete };
      }
      return todo;
    });
    writeTodos(todos);
    Astro.response.status = 300;
  } else if (requestMethod === "DELETE") {
    // idが一致するtodoを削除する
    todos = todos.filter((todo: Todo) => todo.id !== Number(id));
    writeTodos(todos);
    Astro.response.status = 200;
  } else {
    Astro.response.status = 405;
    throw new Error("Method not allowed");
  }
} catch (error) {
  console.error(error);
}
---